Automatically generate products from reactant SMILES.

# Usage

```
$ python3 generate_products.py [file.csv]
$ python3 generate_images.py [file_out.csv]
```

This generates a separate file with the suffix `[file]_out.csv` (any
sanitization errors encountered will be written to `[file]_err.csv`). To
generate images, run `generate_images.py` on this output file.

## Dependencies:

- Python 3.9.4
- RDKit 2021.03.1b1

# How the program works

## Generate transformations

`transforms.py` consists primarily of two dictionaries: one for nucleophiles
and one for electrophiles. Each nucleophile/electrophile is represented as a
SMARTS string, for both reactant and product (see below for an example). Since
all transformations involve only one nucleophile and electrophile, a
comprehensive set of all possible reaction SMARTS (limited to simple SN2-type
reactions) can be generated by iterating through both dictionaries and
performing simple string concatenation.

```
nucleophiles = {
    "alkene": ["[C:1]=[CX3:2]", "[C+:1][CX3:2]"],
		...
}

electrophiles = {
    "C+": ["[CX3+:1]", "[C+0:1]"],
		...
}

transformations = {
        "[C:1]=[CX3:2].[CX3+:1]>>[C+:1][CX3:2][C+0:11]",
        ["alkene", "C+"],
				...
}
```

## Get products out of reactants

`smartjoin.py` accepts two reactants (represented as SMILES) and determines the
most likely product by:

1. iterating through the entire set of transformations,
1. attempting to find each substructure match,
1. applying the corresponding transformation,
1. attempting to sanitize all possible products.

Sanitized products obtained from complex transformations typically take
precedence over those obtained from less complex ones, and the first product
obtained is assumed to be the correct one.

**Important note**: false substructure matches may be obtained; these will be
fixed in due time!

```
$ python3 smartjoin.py 'C1CS[C+](S1)C1=CC=CC=C1.CCCC[Sn](CCCC)(CCCC)CC=C

1 matching transformations found
1: ['alkene', 'C+'], 1 products
Up to 2 good products found
C1CS[C+](S1)C1=CC=CC=C1.CCCC[Sn](CCCC)(CCCC)CC=C>>CCCC[Sn](C[CH+]CC1(C2=CC=CC=C2)SCCS1)(CCCC)CCCC
['alkene', 'C+']
```

## Iterate through csv file, generate images

`generate_products.py` simply parses a csv file and calls `smartjoin.py` on
every reactant SMILES string that it finds. The results are written to a new
csv file. This new file can then be passed to `generate_images.py` to generate
images for all reactions.

The resulting image should look like this:

![](example.png)

# Limitations (what the program doesn't do... yet)

- Any transformations more complex than a simple SN2
- Automatic creation of new SMARTS (nucleophiles and electrophiles have to be manually added)
- Reactions with more than 2 reactants
- Reactions with more than 1 significant product

# TODO

- Concatenate output reaction SMILES to a copy of the input file
- Make SMARTS stricter to avoid false positive matches
- Programmatically detect false positive matches, and give some kind of warning
- `generate_images.py`: accept reactant SMILES as input
- `generate_products`: allow user to choose transformation (and show image afterwards)
- Create a comprehensive test suite (current test is based on an older approach)
